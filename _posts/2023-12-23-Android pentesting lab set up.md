---
title: Android Pentesting Set Up
tags: Android
categories: Mobile Android
---
The aim of this post is to create a virtualized work environment for testing Android applications. We will start by selecting the emulator, then we will download and configure other tools for auditing. I will finish by configuring BurpSuite to intercept traffic for further analysis and modification. Finally, I will also recommend some other useful scripts or applications for these activities.

![Android.png](/assets/img/screenshots/Android_setp/Android.png)

# Creating the working environment

## Prerequisites

### Installing and running Android Debug Bridge (ADB)

Android Debug Bridge is a command line tool that allows to communicate with the mobile device and execute multiple instructions to perform different actions, such as copying or deleting information, installing or uninstalling applications, etc. To install it just run: `sudo apt install abd -y`

### Installing VirtualBox

VirtualBox is needed in Genymotion for virtualization, providing a platform to run and manage virtual Android devices. Before installing VB, install the required dependencies

`sudo apt install build-essential dkms`

Download & install it from the [official website](https://www.virtualbox.org/)

`wget [VirtualBox_Package_URL]`

`sudo dpkg -i [VirtualBox_Package_Name].deb`

### Installing OpenSSL

OpenSSL is an open-source tool that provides various cryptographic functions and utilities and is commonly used for secure communication, certificate handling, and cryptographic tasks.

`sudo apt install openssl`

## Installing and running the emulator (Genymotion)

When setting up the workspace, the first step is choosing an right emulator. An emulator acts like a virtual Android device, allowing users to run test their apps on a computer. There are several Android emulators available, such as [Android Studio](https://developer.android.com/studio), [Genymotion](https://www-v1.genymotion.com/account/create/), [Bluestacks](https://www.bluestacks.com/es/index.html)... choosing the "best" for you may depend on your preferences, but I'd recommend Genymotion because it is the one with which I have had no compatibility problem. So without further ado let's configure it:

For the emulator installation, I'd recommend installing it on the main operating system, not VM. Keep in mind that emulating an Android device requires a significant amount of memory so if you run it in an VM you may have processing or memory issues. I'm running Debian as main OS so I'll explain the installation on it. If you are using another OS follow the steps on the official site.

1.  After installing [ADB and VirtualBox](#prerequisites), create a Genymotion account here [https://www.genymotion.com](https://www.genymotion.com/). This will allow you to download genymotion.
2.  [Download](https://dl.genymotion.com/releases/genymotion-3.6.0/genymotion-3.6.0-linux_x64.bin "https://developer.android.com/studio") and install Genymotion. The installation is pretty straightforward, here are the steps to follow: [Official documentation](https://docs.genymotion.com/desktop/Get_started/013_Linux_install/)

3\. When Genymotion is running, click on "+" button to create a new Android Virtual Machine \*\*I do normally use Google Nexus 4 or 5, but feel free to use any of the list\*\*:

![235049437fc4b4b5192ff6bb4d142888.png](/assets/img/screenshots/Android_setp/235049437fc4b4b5192ff6bb4d142888.png)

In the next Tab,select the desired Android version, I noramlly select Android 10.0 or 8.1 (oreo) for testing. Then press Next until the "Network Mode" tab, where brisged mode must be selected in order to capture traffic with Burpsuite:

![bb4327747b233d0a00f98db1caea84ad.png](/assets/img/screenshots/Android_setp/bb4327747b233d0a00f98db1caea84ad.png)

After that, the automatic installation will be finished and the virtual machine can be deployed. Once the machine is running and you have done the initial Android configuration, click on Open Gapps (in the right side) to be able to have Google applications such as "Play Store". 

![297275a0c068ee2fb7eacbdd92885bc0.png](/assets/img/screenshots/Android_setp/297275a0c068ee2fb7eacbdd92885bc0.png)

## Intercepting requests with BurpSuite

Burp Suite is essential for Android pentesting as it acts as a proxy, allowing to intercept and inspect HTTP(S) requests between the app and its server. By capturing and analyzing this traffic, we can identify vulnerabilities and manipulate data. So after the brief introduction to Burp, install the application from the [official website](https://portswigger.net/burp/documentation/desktop/getting-started/download-and-install).

### Certificate installation

If you have used this software before, you will know that it is necessary to install a trusted certificate so that the browser does not generate errors when working under the HTTPS protocol. Well, to intercept traffic from our Android device we will also have to install such a certificate. So let's configure it :)

Once BurpSuite is installed, create a new project and go to *Proxy tab > Proxy Settings* and a windows like the below will appear. Click on Import/export certificate

![307897714eb7d18849a822a10bb96559.png](/assets/img/screenshots/Android_setp/307897714eb7d18849a822a10bb96559.png)

Export and save as "cacert.der" name:

![b6f3c584739ee32c545e356ef5e3023b.png](/assets/img/screenshots/Android_setp/b6f3c584739ee32c545e356ef5e3023b.png)

The certificates found in the device's system have the nomenclature "subject\_hash\_old.0", so it will be necessary to modify them using the OpenSSL tool.

Modify the certificate format from DER to PEM

`openssl x509 -inform DER -in cacert.der -out cacert.pem`

Obtain the value of the subject\_hash\_old hash from the generated certificate.:

`openssl x509 -inform PEM -subject_hash_old -in cacert.pem`

Rename the certificate with the previously mentioned subject\_hash\_old.0 nomenclature.

`mv cacert.pem 9a5ba575.011`

![e1aa49b61115faba56e1ef9145408af2.png](/assets/img/screenshots/Android_setp/e1aa49b61115faba56e1ef9145408af2.png)

Alright, after these commands, the next steps involve working with the adb tool, [installed above](#installing-and-running-android-debug-bridge-adb) as a prerequisite. 

Run adb with root privileges

`adb root`

Set the /system partition to write mode, as it is in read mode by default:

`adb remount`

Move the cert to VM's SD card

`adb push 9a5ba575.0 /sdcard/`

Move it to the right folder & change permissions:

`adb shell mv /sdcard/9a5ba575.0 /system/etc/security/cacerts`

`adb shell chmod 664 /system/etc/security/cacerts/9a5ba575.0`

In Android devices, there are two types of Trusted Credentials: System and User. These two panels store the certificates trusted by the mobile. To access this config, go to:

Settings → Passwords and Security → Encryption and Credentials → Trusted Credentials.

![7323bb79ccb2bf1109baac5dae29c5a1.png](/assets/img/screenshots/Android_setp/7323bb79ccb2bf1109baac5dae29c5a1.png)

When a user installs a certificate, it is stored in the User Credentials. After Android 7, the way in which Android trusts certificates has changed, and it only trusts those installed in the System. That is why we install the certificate here.

![a15628b9e01f5482073050c41ab1b697.png](/assets/img/screenshots/Android_setp/a15628b9e01f5482073050c41ab1b697.png)

### Proxy configuration

To finish with the process, in the same tab where the certificate export was in Burp Suite, edit the listener that we are going to use and select the local IP address, in my case the IP of the Wifi adapter:

![5e8e086030dbc6710689df60fa4a06e5.png](/assets/img/screenshots/Android_setp/5e8e086030dbc6710689df60fa4a06e5.png)

&nbsp;![59650e75f7bedbb4a4398209f995f0dc.png](/assets/img/screenshots/Android_setp/59650e75f7bedbb4a4398209f995f0dc.png)

Now change the config on the Android device, go to Settings > Wifi and configure it to add a manual proxy as shown in the following images:

![d49c5fcf18a3998dfef701064b8aab89.png](/assets/img/screenshots/Android_setp/d49c5fcf18a3998dfef701064b8aab89.png)

![0922cbd9ada8eeee27bbbff39b792db3.png](/assets/img/screenshots/Android_setp/0922cbd9ada8eeee27bbbff39b792db3.png)

Note that the proxy's value has to be the same as the Burpsuite's listener IP:

![b951c6380f2c491a7dbd000aa9225cf8.png](/assets/img/screenshots/Android_setp/b951c6380f2c491a7dbd000aa9225cf8.png)

Now you should be able to intercept requests in BurpSuite

## Other useful (free) tools

### [Frida](https://github.com/frida/frida)

This open source tool allows you to inject custom code into running Android applications, giving you the ability to monitor and manipulate their behavior in real-time. By hooking methods and modifying their functionality, Frida enables you to bypass security measures, analyze sensitive data, and uncover vulnerabilities that might otherwise go unnoticed.

`pip install frida-tools # CLI tools`  
`pip install frida # Python bindings`  
`npm install frida # Node.js bindings`

### [MobSF (Mobile Security Framework)](https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security)

MobSF is an open-source mobile app security testing framework that supports both Android and iOS platforms. It offers static and dynamic analysis, vulnerability scanning, and API security testing. MobSF can analyze Android APK files, perform in-depth security assessments, and generate detailed reports highlighting potential security risks.

`docker pull opensecurity/mobile-security-framework-mobsf:latest`  
`docker run -it --rm -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest`

### [RMS (Runtime Mobile Security)](https://github.com/iBotPeaches/Apktool) 

Runtime Mobile Security (RMS), powered by FRIDA, is a powerful web interface that helps you to manipulate Android and iOS Apps at Runtime. With RMS you can easily dump all loaded classes and relative methods, hook everything on the fly, trace methods args and return value, load custom scripts and many other useful stuff.

`npm install -g rms-runtime-mobile-security`

### [APKLeaks](https://github.com/dwisiswant0/apkleaks) 

Useful tool to scan APK file for URIs, endpoints & secrets

`pip3 install apkleaks`

### [Radare2](https://github.com/radareorg/radare2)

r2 can edit files on local hard drives, view kernel memory, and debug programs locally or via a remote gdb server. r2's wide architecture support allows you to analyze, emulate, debug, modify, and disassemble any binary.

`git clone https://github.com/radareorg/radare2`

`radare2/sys/install.sh`

Also, [r2frida](https://github.com/nowsecure/r2frida?tab=readme-ov-file) is very useful because it allows to instrument remote processes using frida.

### [Dsexcalibur](https://github.com/FrenchYeti/dexcalibur)

Dexcalibur is an Android reverse engineering platform focus on instrumentation automation. Its particularity is to use dynamic analysis to improve static analysis heuristics. It aims automate boring tasks related to dynamic instrumentation

`docker-compose build android-dexcalibur`

`docker run --rm -it --net=host -v /tmp/dexcalibur:/shared -p 8000:8000 dexcalibur:2023.01 /bin/bash`

### [APKHunt](https://github.com/Cyber-Buddy/APKHunt)

APKHunt is a comprehensive static code analysis tool for Android apps that is based on the OWASP MASVS framework. 

`git clone https://github.com/Cyber-Buddy/APKHunt.git`

`go run apkhunt.go`

### [Adhrit](https://github.com/abhi-r3v0/Adhrit)

Adhrit is an open source Android APK reversing and analysis suite. The tool is an effort to find an efficient solution to all the needs of mobile security testing and automation. 

`git clone https://github.com/abhi-r3v0/Adhrit.git`

`python3 run.py`

### [Fingerprintjs](https://github.com/fingerprintjs/fingerprintjs-android)

Lightweight library for device identification and fingerprinting.

### [APKTool](https://github.com/iBotPeaches/Apktool)

APKTool is a popular tool used for reverse engineering and analyzing Android applications. It allows you to decompile and disassemble APK files, providing you with access to the application’s source code and resources. With APKTool, you can examine the inner workings of an application, identify security flaws, and even modify the code to patch vulnerabilities. It is an essential tool for understanding how Android apps function and for performing code-level analysis.

`sudo apt install apktool`

### [Drozer](https://github.com/WithSecureLabs/drozer)

Drozer is a comprehensive security assessment framework for Android that helps pentesters find security vulnerabilities in applications and devices. It provides a wide range of modules that can be used to perform various tasks, such as finding exported components, manipulating shared preferences, or exploiting known vulnerabilities. Drozer’s powerful functionality makes it an essential tool for both black-box and white-box testing scenarios.

`git clone https://github.com/WithSecureLabs/drozer.git`  
`cd drozer`  
`python setup.py bdist_wheel`

### [QARK](https://github.com/linkedin/qark)

QARK stands for “Quick Android Review Kit” and it was developed by LinkedIn. Is an easy-to-use tool capable of finding common security vulnerabilities in Android applications, it's a common tool to perform basic security checks for an Android application

```
cd qark
pip install -r requirements.txt
pip install . --user  # --user is only needed if not using a virtualenv
qark --help
```

### [zANTI](https://www.zimperium.com/zanti-mobile-penetration-testing/)

zANTI is a comprehensive network diagnostics toolkit that enables complex audits and penetration tests at the push of a button. It offers a comprehensive range of fully customizable scans to reveal everything from authentication, backdoor and brute-force attempts to database, DNS and protocol-specific attacks – including rogue access points.

To use it, download and run in on the Android VM

### [Jadx](https://github.com/skylot/jadx)

JADX is a decompiler for Android applications that translates compiled Android application bytecode (Dex files) into human-readable Java source code. It is commonly used by developers and security researchers to analyze and understand the inner workings of Android applications.

`git clone https://github.com/skylot/jadx.git`  
`cd jadx`  
`./gradlew dist` 

### Other free online tools

* [Inmuniweb](https://www.immuniweb.com/mobile/)

* [Appsweep](https://appsweep.guardsquare.com/)

* [Bevigil](https://bevigil.com/) 

## Useful resources

* [Awesome reverse engineering](https://github.com/alphaSeclab/awesome-reverse-engineering)

* [Awesome mobile security](https://github.com/vaib25vicky/awesome-mobile-security)

* [Android Reports and Resources](https://github.com/B3nac/Android-Reports-and-Resources) 

* [Damn Vulnerable Bank](https://github.com/rewanthtammana/Damn-Vulnerable-Bank) 

* [OVAA](https://github.com/oversecured/ovaa)

* [Frida Labs](https://github.com/DERE-ad2001/Frida-Labs) 

## Happy hacking

As we bid farewell for now, keep in mind that our exploration of Android security is just beginning. Stay tuned for a cascade of upcoming posts, where I will try to unravel the intricacies of vulnerable Android apps and dissect the top exploits that keep the cybersecurity realm on its toes. Your journey into the dynamic world of Android security has only just started, and I look forward to guiding you through each step. Until the next post, happy hacking $$
